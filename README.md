# python-perf-tests

Набор микробенчмарков, предназначенных для сравнения производительности разных
версий Python (3.7–3.14) на одном и том же коде. Репозиторий содержит
унифицированные Dockerfile для каждой версии и тесты, проверяющие корректность
бенчмарков.

## Структура

- `benchmarks/compute.py` — набор задач для измерений: численные расчёты,
  поиск простых чисел и JSON round-trip.
- `benchmarks/benchmark.py` — запускает задачи через `timeit` и сохраняет
  агрегированные результаты в JSON.
- `tests/` — pytests, валидирующие интерфейс и поведение бенчмарков.
- `docker/` — поддиректории с Dockerfile для каждой версии Python.

## Запуск локально

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pytest
python -m benchmarks.benchmark --iterations 5 --repeat 3
```

После запуска `benchmarks.benchmark` результаты будут сохранены в каталоге
`results/` с указанием версии Python в названии файла, а агрегированный файл
`summary.json` будет создан при помощи утилиты `benchmarks.docker_runner`.

## Docker-образы

Для сборки образа конкретной версии Python используйте команды ниже.

```bash
# Пример для Python 3.11
docker build -f docker/py3.11/Dockerfile -t python-perf:3.11 .
```

Запуск бенчмарка в контейнере:

```bash
docker run --rm python-perf:3.11
```

Для запуска тестов вместо бенчмарка переопределите команду:

```bash
docker run --rm python-perf:3.11 python -m pytest -q
```

Аналогичные команды работают для остальных версий (3.7–3.14).

## Автоматическая сборка и запуск всех контейнеров

Чтобы собрать образы всех поддерживаемых версий Python и запустить бенчмарки,
используйте вспомогательный скрипт. Он автоматически пробрасывает локальный
каталог `results/` внутрь контейнеров, чтобы сохранить JSON с измерениями для
каждой версии:

```bash
python -m benchmarks.docker_runner
```

Скрипт по умолчанию последовательно выполнит `docker build` и `docker run`
для каждого Dockerfile в каталоге `docker/`, после чего создаст агрегированный
отчёт `results/summary.json` и выведет его в читаемом виде в консоль.
Дополнительные опции:

- `--dry-run` — только вывести команды Docker без исполнения;
- `--skip-build` или `--skip-run` — пропустить соответствующие этапы;
- `--run-cmd "python -m pytest -q"` — переопределить команду внутри контейнера.
- `--results-dir path/to/dir` — указать альтернативный каталог для сохранения
  результатов;
- `--no-aggregate` — не собирать агрегированный отчёт по завершении запуска.
- `--iterations N` и `--repeat M` — пробросить параметры итераций и повторов
  в `benchmarks.benchmark`, сохранив при этом стандартную команду внутри
  контейнеров.

Флаги `--iterations/--repeat` нельзя комбинировать с `--run-cmd`, поскольку в
этом случае команда целиком задаётся вручную.

Например, чтобы просто вывести список команд без запуска:

```bash
python -m benchmarks.docker_runner --dry-run
```

Набор микробенчмарков, предназначенных для сравнения производительности разных
версий Python (3.7–3.14) на одном и том же коде. Репозиторий содержит
унифицированные Dockerfile для каждой версии и тесты, проверяющие корректность
бенчмарков.

## Структура

- `benchmarks/compute.py` — набор задач для измерений: численные расчёты,
  поиск простых чисел и JSON round-trip.
- `benchmarks/benchmark.py` — запускает задачи через `timeit` и сохраняет
  агрегированные результаты в JSON.
- `tests/` — pytests, валидирующие интерфейс и поведение бенчмарков.
- `docker/` — поддиректории с Dockerfile для каждой версии Python.

## Запуск локально

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pytest
python -m benchmarks.benchmark --iterations 5 --repeat 3
```

После запуска `benchmarks.benchmark` результаты будут сохранены в каталоге
`results/` с указанием версии Python в названии файла, а агрегированный файл
`summary.json` будет создан при помощи утилиты `benchmarks.docker_runner`.

## Docker-образы

Для сборки образа конкретной версии Python используйте команды ниже.

```bash
# Пример для Python 3.11
docker build -f docker/py3.11/Dockerfile -t python-perf:3.11 .
```

Запуск бенчмарка в контейнере:

```bash
docker run --rm python-perf:3.11
```

Для запуска тестов вместо бенчмарка переопределите команду:

```bash
docker run --rm python-perf:3.11 python -m pytest -q
```

Аналогичные команды работают для остальных версий (3.7–3.14).

## Автоматическая сборка и запуск всех контейнеров

Чтобы собрать образы всех поддерживаемых версий Python и запустить бенчмарки,
используйте вспомогательный скрипт. Он автоматически пробрасывает локальный
каталог `results/` внутрь контейнеров, чтобы сохранить JSON с измерениями для
каждой версии:

```bash
python -m benchmarks.docker_runner
```

Скрипт по умолчанию последовательно выполнит `docker build` и `docker run`
для каждого Dockerfile в каталоге `docker/`, после чего создаст агрегированный
отчёт `results/summary.json` и выведет его в читаемом виде в консоль.
Дополнительные опции:

- `--dry-run` — только вывести команды Docker без исполнения;
- `--skip-build` или `--skip-run` — пропустить соответствующие этапы;
- `--run-cmd "python -m pytest -q"` — переопределить команду внутри контейнера.
- `--results-dir path/to/dir` — указать альтернативный каталог для сохранения
  результатов;
- `--no-aggregate` — не собирать агрегированный отчёт по завершении запуска.

Например, чтобы просто вывести список команд без запуска:

```bash
python -m benchmarks.docker_runner --dry-run
```

Набор микробенчмарков, предназначенных для сравнения производительности разных
версий Python (3.7–3.14) на одном и том же коде. Репозиторий содержит
унифицированные Dockerfile для каждой версии и тесты, проверяющие корректность
бенчмарков.

## Структура

- `benchmarks/compute.py` — набор задач для измерений: численные расчёты,
  поиск простых чисел и JSON round-trip.
- `benchmarks/benchmark.py` — запускает задачи через `timeit` и сохраняет
  агрегированные результаты в JSON.
- `tests/` — pytests, валидирующие интерфейс и поведение бенчмарков.
- `docker/` — поддиректории с Dockerfile для каждой версии Python.

## Запуск локально

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pytest
python -m benchmarks.benchmark --iterations 5 --repeat 3
```

После запуска `benchmarks.benchmark` результаты будут сохранены в каталоге
`results/` с указанием версии Python в названии файла.

## Docker-образы

Для сборки образа конкретной версии Python используйте команды ниже.

```bash
# Пример для Python 3.11
docker build -f docker/py3.11/Dockerfile -t python-perf:3.11 .
```

Запуск бенчмарка в контейнере:

```bash
docker run --rm python-perf:3.11
```

Для запуска тестов вместо бенчмарка переопределите команду:

```bash
docker run --rm python-perf:3.11 python -m pytest -q
```

Аналогичные команды работают для остальных версий (3.7–3.14).

## Автоматическая сборка и запуск всех контейнеров

Чтобы собрать образы всех поддерживаемых версий Python и запустить бенчмарки,
используйте вспомогательный скрипт:

```bash
python -m benchmarks.docker_runner
```

Скрипт по умолчанию последовательно выполнит `docker build` и `docker run`
для каждого Dockerfile в каталоге `docker/`. Дополнительные опции:

- `--dry-run` — только вывести команды Docker без исполнения;
- `--skip-build` или `--skip-run` — пропустить соответствующие этапы;
- `--run-cmd "python -m pytest -q"` — переопределить команду внутри контейнера.

Например, чтобы просто вывести список команд без запуска:

```bash
python -m benchmarks.docker_runner --dry-run
```

Набор микробенчмарков, предназначенных для сравнения производительности разных
версий Python (3.7–3.14) на одном и том же коде. Репозиторий содержит
унифицированные Dockerfile для каждой версии и тесты, проверяющие корректность
бенчмарков.

## Структура

- `benchmarks/compute.py` — набор задач для измерений: численные расчёты,
  поиск простых чисел и JSON round-trip.
- `benchmarks/benchmark.py` — запускает задачи через `timeit` и сохраняет
  агрегированные результаты в JSON.
- `tests/` — pytests, валидирующие интерфейс и поведение бенчмарков.
- `docker/` — поддиректории с Dockerfile для каждой версии Python.

## Запуск локально

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pytest
python -m benchmarks.benchmark --iterations 5 --repeat 3
```

После запуска `benchmarks.benchmark` результаты будут сохранены в каталоге
`results/` с указанием версии Python в названии файла.

## Docker-образы

Для сборки образа конкретной версии Python используйте команды ниже.

```bash
# Пример для Python 3.11
docker build -f docker/py3.11/Dockerfile -t python-perf:3.11 .
```

Запуск бенчмарка в контейнере:

```bash
docker run --rm python-perf:3.11
```

Для запуска тестов вместо бенчмарка переопределите команду:

```bash
docker run --rm python-perf:3.11 python -m pytest -q
```

Аналогичные команды работают для остальных версий (3.7–3.14).
